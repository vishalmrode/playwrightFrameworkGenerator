'use strict';

var createDeferred = require('../async/createDeferred.js');
var getAuthInfo = require('../authentication/getAuthInfo.js');
var logger = require('../logger.js');
var waitForAuthInfo = require('./waitForAuthInfo.js');

async function initializeAuthInfo({ accessToken }) {
  if (waitForAuthInfo.deferredAuthInfo.status !== createDeferred.STATUS_RESOLVED) {
    let authInfo = void 0;
    if (accessToken) {
      try {
        authInfo = await getAuthInfo.getAuthInfo(accessToken);
      } catch (error) {
        logger.logError("InitializeSession:AuthInfoQueryFailed", { error });
      }
    }
    waitForAuthInfo.deferredAuthInfo.resolve(authInfo);
  }
}

exports.initializeAuthInfo = initializeAuthInfo;
